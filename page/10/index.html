<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>建均笔记</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="建均笔记">
<meta property="og:url" content="http://www.uto.ink/page/10/index.html">
<meta property="og:site_name" content="建均笔记">
<meta property="og:locale">
<meta property="article:author" content="建均笔记">
<meta name="twitter:card" content="summary">
  
  <meta name="keywords" content="建均笔记">
  
  
    <link rel="alternative" href="/atom.xml" title="建均笔记" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
<link rel="stylesheet" href="/css/style.css">

<script>
(function(){
    var bp = document.createElement('script');
    bp.src = '//push.zhanzhang.baidu.com/push.js';
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

<!-- baidu Analytics -->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?b5a8646d4b9e56cf6ef835a8e416f147";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>
<!-- End baidu Analytics -->


<link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css" />
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/avatar.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">建均笔记</a></h1>
		</hgroup>

		
		<p class="header-subtitle">不积跬步 无以至千里</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
					</div>

				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
							<li><a href="/about">关于我</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/stotem" title="github">github</a>
					        
								<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
					        
								<a class="mail" target="_blank" href="mailto:china.wujianjun@icloud.com" title="mail">mail</a>
					        
						</div>
						<div>
							<i class="fa fa-line-chart"></i>
							本站访问量<span id=“busuanzi_container_site_pv”><span id="busuanzi_value_site_pv"><i class="fa fa-spinner fa-spin"></i></span></span> 次
						</div>
					</nav>
				</section>

				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/Docker/" style="font-size: 15.71px;">Docker</a> <a href="/tags/Java/" style="font-size: 10px;">Java</a> <a href="/tags/Maven/" style="font-size: 11.43px;">Maven</a> <a href="/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/tags/Nginx/" style="font-size: 15.71px;">Nginx</a> <a href="/tags/OpenVPN/" style="font-size: 12.86px;">OpenVPN</a> <a href="/tags/Podman/" style="font-size: 11.43px;">Podman</a> <a href="/tags/Redis/" style="font-size: 11.43px;">Redis</a> <a href="/tags/Transaction/" style="font-size: 10px;">Transaction</a> <a href="/tags/cdt/" style="font-size: 10px;">cdt</a> <a href="/tags/https/" style="font-size: 10px;">https</a> <a href="/tags/iOS/" style="font-size: 17.14px;">iOS</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/nginx-obs/" style="font-size: 10px;">nginx + obs</a> <a href="/tags/php-fpm/" style="font-size: 10px;">php-fpm</a> <a href="/tags/podman/" style="font-size: 14.29px;">podman</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/rocketmq/" style="font-size: 10px;">rocketmq</a> <a href="/tags/shiro/" style="font-size: 11.43px;">shiro</a> <a href="/tags/spring/" style="font-size: 11.43px;">spring</a> <a href="/tags/springcloud/" style="font-size: 10px;">springcloud</a> <a href="/tags/tomcat/" style="font-size: 10px;">tomcat</a> <a href="/tags/transaction/" style="font-size: 10px;">transaction</a> <a href="/tags/%E5%85%B3%E9%94%AE%E7%AC%94%E8%AE%B0/" style="font-size: 10px;">关键笔记</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 10px;">分布式</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/" style="font-size: 10px;">分布式事务</a> <a href="/tags/%E5%8E%9F%E5%88%9B/" style="font-size: 20px;">原创</a> <a href="/tags/%E5%A4%9A%E8%BF%9B%E7%A8%8B/" style="font-size: 10px;">多进程</a> <a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 11.43px;">大数据</a> <a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 10px;">并发</a> <a href="/tags/%E6%80%BB%E7%BB%93/" style="font-size: 10px;">总结</a> <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 10px;">操作系统</a> <a href="/tags/%E6%9E%B6%E6%9E%84/" style="font-size: 10px;">架构</a> <a href="/tags/%E7%94%B5%E5%95%86/" style="font-size: 10px;">电商</a> <a href="/tags/%E7%AC%94%E8%AE%B0/" style="font-size: 10px;">笔记</a> <a href="/tags/%E8%BD%AC%E8%BD%BD/" style="font-size: 18.57px;">转载</a> <a href="/tags/%E9%9A%8F%E7%AC%94/" style="font-size: 10px;">随笔</a>
					</div>
				</section>
				

				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://andylee1988.github.io">andylee1988的博客</a><br />
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://devtll.github.io">devtll的博客</a><br />
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://esnake0.github.io">esnake0的博客</a><br />
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.shaofan.org">少凡的独立博客</a><br />
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://blog.csdn.net/liuguofeng719?viewmode=list">guofeng的博客</a><br />
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://witchan.com">WitChan的技术博客</a><br />
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://blog.csdn.net/kelanq">kelanQ的博客</a><br />
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://chenxinyu.work">IT古书</a><br />
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://8tool.club">KnowledgeBase</a><br />
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://cherrycheng.top">cherrycheng</a><br />
			        
			        </div>
				</section>
				

				
			</div>
		</div>

	</header>
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">建均笔记</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="/img/avatar.jpg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">建均笔记</h1>
			</hgroup>
			
			<p class="header-subtitle">不积跬步 无以至千里</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/about">关于我</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/stotem" title="github">github</a>
			        
						<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
			        
						<a class="mail" target="_blank" href="mailto:china.wujianjun@icloud.com" title="mail">mail</a>
			        
				</div>
				<div style="text-align: center;">
					<i class="fa fa-line-chart"></i>
					本站访问量<span id=“busuanzi_container_site_pv”><span id="busuanzi_value_site_pv"><i class="fa fa-spinner fa-spin"></i></span></span> 次
				</div>
			</nav>
		</header>
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-header-version" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/21/header-version/" class="article-date">
  	<time datetime="2016-03-21T09:02:06.000Z" itemprop="datePublished">2016-03-21</time>
</a>
      <div class="analysis-container">
	<i class="fa fa-line-chart"></i>
	已阅读<span id=“busuanzi_container_page_pv”><span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span></span> 次
</div>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/21/header-version/">开放平台Api的版本控制方案</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
              
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>做开放平台供外部调用的Api理论上变化越少针对调用者来讲越有利，随着开放平台的功能不断完善（优化）不可避免的需要添加新的资源，或者修改现有资源。因此Api的更新升级必不可少，但是，对于开放平台来讲从一开始就应该将对外提供的Api加入版本管理。一个长期稳定可用的开放平台才能被越来越多的用户使用。<br>同理，Native的App与服务器Api也存在同样的关系，Native App安装在不同的移动设备上，如果Api变动都需要提示用户进行强制更新来适配新版本的Api接口，那么，App用户将异常烦躁甚至于将App从设备中Uninstall掉。</p>
<p>查看众多论坛与博客，总结出目前实现有三种方式：</p>
<ul>
<li>URI<br>在访问Api中增加version段来告诉服务器所使用的Api版本（如：<a target="_blank" rel="noopener" href="http://xxxx/api/customers/v1.1/1234">http://xxxx/api/customers/v1.1/1234</a>  ）。 这种方式正是由于在uri中增加了version段，破坏掉了Api的统一访问URL。</li>
<li>Request Parameter<br>在Api后增加请求参数来告诉服务器所使用的Api版本（如：<a target="_blank" rel="noopener" href="http://xxxx/api/customers/1234?v=1.1">http://xxxx/api/customers/1234?v=1.1</a> ）这种方式与第一种URI的方式类似。</li>
<li>Request Header<br>在请求Api时在Request的请求头中增加Version值来告诉服务器所使用的Api版本。这种方式保留了Api统一访问的URL，版本号传递更隐秘。但需要客户端在请求时增加此参数来完成，所以需要App在开发之初就需要增加版本号的传递。</li>
</ul>
<p>综上所述，个人认为第三种 Request Header的传递方式具有统一了URL和Version段隐秘的优点，为最适合的传递方式。</p>
<h2 id="Request-Header方式实现版本控制"><a href="#Request-Header方式实现版本控制" class="headerlink" title="Request Header方式实现版本控制"></a>Request Header方式实现版本控制</h2><p>说完了客户端传递版本号的方式之后，我们来看一下服务端的处理。按流行的MVC的方式来看，个人觉得应该在控制层之前增加Api的版本控制层来先对客户端的请求Api进行版本的预判。</p>
<p><img src="/images/QQ20160321-0.png"></p>
<p>个人总结了一下，有以下几种预判结果：<br>1: Api为所有版本提供服务。<br>2: Api提供了最低版本，为大于此最低版本的请求提供服务。<br>3: Api提供了服务的版本范围，为大于最低版本且小于最高版本的请求提供服务。<br>4: Api已过期，由其它的Api代替。<br>5: Api已废弃不再提供服务。</p>
<p>按以上思路，按Java实现为例。可以通过 自定义注解（Annotation）+ 过滤器（Filter）实现。<br>相似的方案还有：自定义注解 + 拦截器， 自定义注解 + Spring AOP<br>同理，其它的语言均有类似技术可以实现。</p>
<p>接下来我将在 <a target="_blank" rel="noopener" href="https://github.com/stotem/header-version-filter.git">https://github.com/stotem/header-version-filter.git</a> 中公布我的Annotation+Filter实现。</p>
<hr>
<p><em>观点仅代表自己，期待你的留言。</em></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-php-fpm" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/21/php-fpm/" class="article-date">
  	<time datetime="2016-03-21T07:01:31.000Z" itemprop="datePublished">2016-03-21</time>
</a>
      <div class="analysis-container">
	<i class="fa fa-line-chart"></i>
	已阅读<span id=“busuanzi_container_page_pv”><span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span></span> 次
</div>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/21/php-fpm/">Nginx+php-fpm替代apache服务器</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
              
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>nginx本身不能处理PHP，它只是个web服务器，当接收到请求后，如果是php请求，则发给php解释器处理，并把结果返回给客户端。</p>
<p>nginx一般是把请求发fastcgi管理进程处理，fascgi管理进程选择cgi子进程处理结果并返回被nginx</p>
<p>本文以php-fpm为例介绍如何使nginx支持PHP<br>一、编译安装php-fpm</p>
<p>什么是PHP-FPM</p>
<p>PHP-FPM是一个PHP FastCGI管理器，是只用于PHP的,可以在 <a target="_blank" rel="noopener" href="http://php-fpm.org/download">http://php-fpm.org/download</a> 下载得到.</p>
<p>PHP-FPM其实是PHP源代码的一个补丁，旨在将FastCGI进程管理整合进PHP包中。必须将它patch到你的PHP源代码中，在编译安装PHP后才可以使用。</p>
<p>新版PHP已经集成php-fpm了，不再是第三方的包了，推荐使用。PHP-FPM提供了更好的PHP进程管理方式，可以有效控制内存和进程、可以平滑重载PHP配置，比spawn-fcgi具有更多有点，所以被PHP官方收录了。在./configure的时候带 –enable-fpm参数即可开启PHP-FPM。</p>
<p>新版php-fpm安装(推荐安装方式)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget http://cn2.php.net/distributions/php-5.4.7.tar.gz</span><br><span class="line">tar zvxf php-5.4.7.tar.gz</span><br><span class="line">cd php-5.4.7</span><br><span class="line">./configure --prefix=/usr/local/php --enable-fastcgi --enable-fpm --with-mcrypt --with-zlib --enable-mbstring --disable-pdo --with-curl --disable-debug --enable-pic --disable-rpath --enable-inline-optimization --with-bz2 --with-xml --with-zlib --enable-sockets --enable-sysvsem --enable-sysvshm --enable-pcntl --enable-mbregex --with-mhash --enable-xslt --enable-memcache --enable-zip --with-pcre-regex --with-mysql</span><br><span class="line">make all install</span><br></pre></td></tr></table></figure>
<p>旧版手动打补丁php-fpm安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wget http://cn2.php.net/get/php-5.2.17.tar.gz</span><br><span class="line">wget http://php-fpm.org/downloads/php-5.2.17-fpm-0.5.14.diff.gz</span><br><span class="line"></span><br><span class="line">tar zvxf php-5.2.17.tar.gz</span><br><span class="line">gzip -cd php-5.2.17-fpm-0.5.14.diff.gz | patch -d php-5.2.17 -p1</span><br><span class="line">cd php-5.2.17</span><br><span class="line">./configure --prefix=/usr/local/php  --enable-fpm --with-mcrypt --enable-mbstring --disable-pdo --with-curl --disable-debug  --disable-rpath --enable-inline-optimization --with-bz2  --with-zlib --enable-sockets --enable-sysvsem --enable-sysvshm --enable-pcntl --enable-mbregex --with-mhash --enable-zip --with-pcre-regex --with-mysql --with-mysqli --with-gd --with-jpeg-dir</span><br><span class="line">make all install</span><br><span class="line">cd /usr/local/php</span><br><span class="line">cp etc/php-fpm.conf.default etc/php-fpm.conf</span><br><span class="line">/usr/local/php/sbin/php-fpm</span><br></pre></td></tr></table></figure>
<p>以上两种方式都可以安装php-fpm，安装后内容放在/usr/local/php目录下</p>
<p>二、修改nginx配置文件以支持php-fpm<br>nginx安装完成后，修改nginx配置文件为,nginx.conf</p>
<p>其中server段增加如下配置，注意标红内容配置，否则会出现No input file specified.错误</p>
<p>#pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">location ~ \.php$ &#123;</span><br><span class="line">root html;</span><br><span class="line">fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">fastcgi_index index.php;</span><br><span class="line">fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class="line">include fastcgi_params;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>转自：<a target="_blank" rel="noopener" href="http://www.cnblogs.com/hujiong/archive/2013/02/20/2918509.html">http://www.cnblogs.com/hujiong/archive/2013/02/20/2918509.html</a> </p>
<hr>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Nginx/" rel="tag">Nginx</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php-fpm/" rel="tag">php-fpm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%BD%AC%E8%BD%BD/" rel="tag">转载</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-nginx-muti-domain" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/18/nginx-muti-domain/" class="article-date">
  	<time datetime="2016-03-18T08:43:49.000Z" itemprop="datePublished">2016-03-18</time>
</a>
      <div class="analysis-container">
	<i class="fa fa-line-chart"></i>
	已阅读<span id=“busuanzi_container_page_pv”><span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span></span> 次
</div>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/18/nginx-muti-domain/">Nginx反向代理多个域名</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
              
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>由于公司内网有多台服务器的http服务要映射到公司外网静态IP，如果用路由的端口映射来做，就只能一台内网服务器的80端口映射到外网80端口，其他服务器的80端口只能映射到外网的非80端口。非80端口的映射在访问的时候要域名加上端口，比较麻烦。所以我们可以在内网搭建个nginx反向代理服务器，将nginx反向代理服务器的80映射到外网IP的80，这样指向到公司外网IP的域名的HTTP请求就会发送到nginx反向代理服务器，利用nginx反向代理将不同域名的请求转发给内网不同机器的端口，就起到了“根据域名自动转发到相应服务器的特定端口”的效果，而路由器的端口映射做到的只是“根据不同端口自动转发到相应服务器的特定端口”，真是喜大普奔啊。</p>
<h2 id="Nginx配置"><a href="#Nginx配置" class="headerlink" title="Nginx配置"></a>Nginx配置</h2><p>vim /usr/local/nginx/conf/reverse-proxy.conf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name tomcat1.vip.com;</span><br><span class="line">    location /&#123;</span><br><span class="line">        proxy_redirect off;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        proxy_pass http://127.0.0.1:8081;</span><br><span class="line">        #proxy_pass http://tomcat;</span><br><span class="line">    &#125;</span><br><span class="line">    access_log logs/tomcat1_access.log;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name tomcat2.vip.com;</span><br><span class="line">    location /&#123;</span><br><span class="line">        proxy_redirect off;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        proxy_pass http://127.0.0.1:8082;</span><br><span class="line">        #proxy_pass http://tomcat;</span><br><span class="line">    &#125;</span><br><span class="line">    access_log logs/tomcat2_access.log;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在nginx.conf的http节点中include配置文件reverse-proxy.conf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">	include reverse-proxy.conf;</span><br><span class="line"></span><br><span class="line">    #按server段顺序匹配，如果没有匹配到则可通过泛域名匹配返回错误码或错误页</span><br><span class="line">    server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name *.vip.com;</span><br><span class="line">        location /&#123;</span><br><span class="line">            return 404;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="测试生效"><a href="#测试生效" class="headerlink" title="测试生效"></a>测试生效</h2><p>热部署nginx配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# /usr/local/nginx/sbin/nginx -t; /usr/local/nginx/sbin/nginx -s reload;</span><br><span class="line">nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful</span><br></pre></td></tr></table></figure>
<p>在客户机的hosts中配置tomcat1.vip.com和tomcat2.vip.com （如果是已申请好的域名，则可跳过此步骤）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">10.28.10.218 tomcat1.vip.com</span><br><span class="line">10.28.10.218 tomcat2.vip.com</span><br></pre></td></tr></table></figure>
<p><img src="/images/QQ20160318-3.png"></p>
<p>从以上访问结果来看，浏览器的请求会分别引导到了tomcat1和tomcat2上。</p>
<hr>
<p><em>观点仅代表自己，期待你的留言。</em></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Nginx/" rel="tag">Nginx</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-linux-strace" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/18/linux-strace/" class="article-date">
  	<time datetime="2016-03-18T07:40:02.000Z" itemprop="datePublished">2016-03-18</time>
</a>
      <div class="analysis-container">
	<i class="fa fa-line-chart"></i>
	已阅读<span id=“busuanzi_container_page_pv”><span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span></span> 次
</div>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/18/linux-strace/">linux-strace跟踪运行中进程对系统资源的访问</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
              
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>strace常用来跟踪进程执行时的系统调用和所接收的信号。 在Linux世界，进程不能直接访问硬件设备，当进程需要访问硬件设备(比如读取磁盘文件，接收网络数据等等)时，必须由用户态模式切换至内核态模式，通 过系统调用访问硬件设备。strace可以跟踪到一个进程产生的系统调用,包括参数，返回值，执行消耗的时间。</p>
<h2 id="输出参数含义"><a href="#输出参数含义" class="headerlink" title="输出参数含义"></a>输出参数含义</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:/usr# strace cat /dev/null</span><br><span class="line">execve(&quot;/bin/cat&quot;, [&quot;cat&quot;, &quot;/dev/null&quot;], [/* 22 vars */]) = 0</span><br><span class="line">brk(0)                                  = 0xab1000</span><br><span class="line">access(&quot;/etc/ld.so.nohwcap&quot;, F_OK)      = -1 ENOENT (No such file or directory)</span><br><span class="line">mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f29379a7000</span><br><span class="line">access(&quot;/etc/ld.so.preload&quot;, R_OK)      = -1 ENOENT (No such file or directory)</span><br><span class="line">...</span><br><span class="line">brk(0) = 0xab1000</span><br><span class="line">brk(0xad2000) = 0xad2000</span><br><span class="line">fstat(1, &#123;st_mode=S_IFCHR|0620, st_rdev=makedev(136, 0), ...&#125;) = 0</span><br><span class="line">open(&quot;/dev/null&quot;, O_RDONLY) = 3</span><br><span class="line">fstat(3, &#123;st_mode=S_IFCHR|0666, st_rdev=makedev(1, 3), ...&#125;) = 0</span><br><span class="line">read(3, &quot;&quot;, 32768) = 0</span><br><span class="line">close(3) = 0</span><br><span class="line">close(1) = 0</span><br><span class="line">close(2) = 0</span><br><span class="line">exit_group(0) = ?</span><br></pre></td></tr></table></figure>
<p>每一行都是一条系统调用，等号左边是系统调用的函数名及其参数，右边是该调用的返回值。<br>strace 显示这些调用的参数并返回符号形式的值。strace 从内核接收信息，而且不需要以任何特殊的方式来构建内核。</p>
<h2 id="strace参数"><a href="#strace参数" class="headerlink" title="strace参数"></a>strace参数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">-c 统计每一系统调用的所执行的时间,次数和出错的次数等.</span><br><span class="line">-d 输出strace关于标准错误的调试信息.</span><br><span class="line">-f 跟踪由fork调用所产生的子进程.</span><br><span class="line">-ff 如果提供-o filename,则所有进程的跟踪结果输出到相应的filename.pid中,pid是各进程的进程号.</span><br><span class="line">-F 尝试跟踪vfork调用.在-f时,vfork不被跟踪.</span><br><span class="line">-h 输出简要的帮助信息.</span><br><span class="line">-i 输出系统调用的入口指针.</span><br><span class="line">-q 禁止输出关于脱离的消息.</span><br><span class="line">-r 打印出相对时间关于,,每一个系统调用.</span><br><span class="line">-t 在输出中的每一行前加上时间信息.</span><br><span class="line">-tt 在输出中的每一行前加上时间信息,微秒级.</span><br><span class="line">-ttt 微秒级输出,以秒了表示时间.</span><br><span class="line">-T 显示每一调用所耗的时间.</span><br><span class="line">-v 输出所有的系统调用.一些调用关于环境变量,状态,输入输出等调用由于使用频繁,默认不输出.</span><br><span class="line">-V 输出strace的版本信息.</span><br><span class="line">-x 以十六进制形式输出非标准字符串</span><br><span class="line">-xx 所有字符串以十六进制形式输出.</span><br><span class="line">-a column</span><br><span class="line">设置返回值的输出位置.默认 为40.</span><br><span class="line">-e expr</span><br><span class="line">指定一个表达式,用来控制如何跟踪.格式如下:</span><br><span class="line">[qualifier=][!]value1[,value2]...</span><br><span class="line">qualifier只能是 trace,abbrev,verbose,raw,signal,read,write其中之一.value是用来限定的符号或数字.默认的 qualifier是 trace.感叹号是否定符号.例如:</span><br><span class="line">-eopen等价于 -e trace=open,表示只跟踪open调用.而-etrace!=open表示跟踪除了open以外的其他调用.有两个特殊的符号 all 和 none.</span><br><span class="line">注意有些shell使用!来执行历史记录里的命令,所以要使用\\.</span><br><span class="line">-e trace=set</span><br><span class="line">只跟踪指定的系统 调用.例如:-e trace=open,close,rean,write表示只跟踪这四个系统调用.默认的为set=all.</span><br><span class="line">-e trace=file</span><br><span class="line">只跟踪有关文件操作的系统调用.</span><br><span class="line">-e trace=process</span><br><span class="line">只跟踪有关进程控制的系统调用.</span><br><span class="line">-e trace=network</span><br><span class="line">跟踪与网络有关的所有系统调用.</span><br><span class="line">-e strace=signal</span><br><span class="line">跟踪所有与系统信号有关的 系统调用</span><br><span class="line">-e trace=ipc</span><br><span class="line">跟踪所有与进程通讯有关的系统调用</span><br><span class="line">-e abbrev=set</span><br><span class="line">设定 strace输出的系统调用的结果集.-v 等与 abbrev=none.默认为abbrev=all.</span><br><span class="line">-e raw=set</span><br><span class="line">将指 定的系统调用的参数以十六进制显示.</span><br><span class="line">-e signal=set</span><br><span class="line">指定跟踪的系统信号.默认为all.如 signal=!SIGIO(或者signal=!io),表示不跟踪SIGIO信号.</span><br><span class="line">-e read=set</span><br><span class="line">输出从指定文件中读出 的数据.例如:</span><br><span class="line">-e read=3,5</span><br><span class="line">-e write=set</span><br><span class="line">输出写入到指定文件中的数据.</span><br><span class="line">-o filename</span><br><span class="line">将strace的输出写入文件filename</span><br><span class="line">-p pid</span><br><span class="line">跟踪指定的进程pid.</span><br><span class="line">-s strsize</span><br><span class="line">指定输出的字符串的最大长度.默认为32.文件名一直全部输出.</span><br><span class="line">-u username</span><br><span class="line">以username 的UID和GID执行被跟踪的命令</span><br></pre></td></tr></table></figure>

<h2 id="命令实例"><a href="#命令实例" class="headerlink" title="命令实例"></a>命令实例</h2><p>通用的完整用法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strace -o output.txt -T -tt -e trace=all -p 28979</span><br></pre></td></tr></table></figure>
<p>上面的含义是 跟踪28979进程的所有系统调用（-e trace=all），并统计系统调用的花费时间，以及开始时间（并以可视化的时分秒格式显示），最后将记录结果存在output.txt文件里面。</p>
<h2 id="限制strace只跟踪特定的系统调用"><a href="#限制strace只跟踪特定的系统调用" class="headerlink" title="限制strace只跟踪特定的系统调用"></a>限制strace只跟踪特定的系统调用</h2><p>如果你已经知道你要找什么，你可以让strace只跟踪一些类型的系统调用。例如，你需要看看在configure脚本里面执行的程序，你需要监视的系统调 用就是execve。让strace只记录execve的调用用这个命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strace -f -o configure-strace.txt -e execve ./configure</span><br></pre></td></tr></table></figure>

<hr>
<p>精品博文转自： <a target="_blank" rel="noopener" href="http://www.cnblogs.com/ggjucheng/archive/2012/01/08/2316692.html">http://www.cnblogs.com/ggjucheng/archive/2012/01/08/2316692.html</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%BD%AC%E8%BD%BD/" rel="tag">转载</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-nginx-upstream-jvm-route" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/18/nginx-upstream-jvm-route/" class="article-date">
  	<time datetime="2016-03-18T01:35:55.000Z" itemprop="datePublished">2016-03-18</time>
</a>
      <div class="analysis-container">
	<i class="fa fa-line-chart"></i>
	已阅读<span id=“busuanzi_container_page_pv”><span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span></span> 次
</div>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/18/nginx-upstream-jvm-route/">Nginx+tomcat+redis集群之session跟踪（nginx_upstream_jvm_route）</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
              
        <h2 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h2><p>CentOS7, Tomcat7(tomcat-1, tomcat-2), Nginx1.8.1, redis3.0.7</p>
<p>tomcat1：Server port=”8105”，Connector port=”8081”，ajp Connector port=”8109”</p>
<p>tomcat2：Server port=”8205”，Connector port=”8082”，ajp Connector port=”8209”</p>
<h2 id="集群环境下tomcat的session处理方式"><a href="#集群环境下tomcat的session处理方式" class="headerlink" title="集群环境下tomcat的session处理方式"></a>集群环境下tomcat的session处理方式</h2><h3 id="一、upstream-ip-hash（不推荐使用）"><a href="#一、upstream-ip-hash（不推荐使用）" class="headerlink" title="一、upstream ip_hash（不推荐使用）"></a>一、upstream ip_hash（不推荐使用）</h3><p> nginx中的ip_hash技术能够将某个ip的请求定向到同一台后端，这样一来这个ip下的某个客户端和某个后端就能建立起稳固的session，ip_hash是在upstream配置中定义的： </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123; </span><br><span class="line">    server 127.0.0.1:8081 ; </span><br><span class="line">    server 127.0.0.1:8082 ; </span><br><span class="line">    ip_hash; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>不推荐使用的原因如下：</p>
<ul>
<li><strong>nginx不是最前端的服务器。</strong> ip_hash要求nginx一定是最前端的服务器，否则nginx得不到正确ip，就不能根据ip作hash。譬如使用的是squid为最前端，那么nginx取ip时只能得到squid的服务器ip地址，用这个地址来作分流是肯定错乱的。 </li>
<li><strong>nginx的后端还有其它方式的负载均衡。</strong><br>假如nginx后端又有其它负载均衡，将请求又通过另外的方式分流了，那么某个客户端的请求肯定不能定位到同一台session应用服务器上。</li>
<li><strong>多个外网出口。</strong><br> 很多公司上网有多个出口，多个ip地址，用户访问互联网时候自动切换ip。而且这种情况不在少数。使用 ip_hash 的话对这种情况的用户无效，无法将某个用户绑定在固定的tomcat上 。<h3 id="二、nginx-upstream-jvm-route-nginx-module，-无法故障转移"><a href="#二、nginx-upstream-jvm-route-nginx-module，-无法故障转移" class="headerlink" title="二、nginx_upstream_jvm_route (nginx module， 无法故障转移)"></a>二、nginx_upstream_jvm_route (nginx module， 无法故障转移)</h3>nginx_upstream_jvm_route 是一个nginx的扩展模块，用来实现基于 Cookie 的 Session Sticky 的功能。</li>
</ul>
<p>简单来说，它是基于cookie中的JSESSIONID来决定将请求发送给后端的哪个server，nginx_upstream_jvm_route会在用户第一次请求后端server时，将响应的server标识绑定到cookie中的JSESSIONID中，从而当用户发起下一次请求时，nginx会根据JSESSIONID来决定由哪个后端server来处理。</p>
<p>但是当客户端对应的tomcat挂掉之后，客户端的请求将不能通过其它tomcat代替进行处理，也就是说 __nginx_upstream_jvm_route不支持故障转移__。</p>
<h3 id="三、tomcat-redis-session-manager-（java-lib，-推荐使用）"><a href="#三、tomcat-redis-session-manager-（java-lib，-推荐使用）" class="headerlink" title="三、tomcat-redis-session-manager （java lib， 推荐使用）"></a>三、tomcat-redis-session-manager （java lib， 推荐使用）</h3><p>通过集群实例tomcat连接到同一个redis，将sessionID存储在redis中完成session共享。由于session共享，所以支持故障转移。</p>
<p>详见我的另一篇博文《Nginx+tomcat+redis集群之session共享》</p>
<h2 id="nginx-upstream-jvm-route安装配置"><a href="#nginx-upstream-jvm-route安装配置" class="headerlink" title="nginx_upstream_jvm_route安装配置"></a>nginx_upstream_jvm_route安装配置</h2><p>github地址：<a target="_blank" rel="noopener" href="https://github.com/nulab/nginx-upstream-jvm-route">https://github.com/nulab/nginx-upstream-jvm-route</a></p>
<p>安装方法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# git clone https://github.com/nulab/nginx-upstream-jvm-route.git</span><br><span class="line">[root@localhost ~]# cd nginx-1.8.1 //注意：一定是进入到nginx安装目录打补丁</span><br><span class="line">[root@localhost nginx-1.8.1]# patch -p0 &lt; ../nginx-upstream-jvm-route/jvm_route.patch </span><br><span class="line">patching file src/http/ngx_http_upstream.c</span><br><span class="line">Hunk #1 succeeded at 5281 (offset 672 lines).</span><br><span class="line">Hunk #2 succeeded at 5380 (offset 678 lines).</span><br><span class="line">Hunk #3 succeeded at 5397 (offset 656 lines).</span><br><span class="line">Hunk #4 succeeded at 5434 (offset 656 lines).</span><br><span class="line">Hunk #5 succeeded at 5467 (offset 656 lines).</span><br><span class="line">Hunk #6 succeeded at 5527 (offset 671 lines).</span><br><span class="line">patching file src/http/ngx_http_upstream.h</span><br><span class="line">Hunk #1 succeeded at 96 (offset 4 lines).</span><br><span class="line">Hunk #2 succeeded at 110 (offset 4 lines).</span><br><span class="line">[root@localhost nginx-1.8.1]# ./configure --with-pcre=../pcre-8.38 --with-zlib=../zlib-1.2.8 --with-http_gzip_static_module --with-http_ssl_module --add-module=../nginx_tcp_proxy_module/ \--add-module=../nginx_upstream_check_module/ \--add-module=../nginx-module-vts/ \--add-module=../nginx-upstream-jvm-route/</span><br><span class="line">[root@localhost nginx-1.8.1]# make</span><br><span class="line">[root@localhost nginx-1.8.1]# mv /usr/local/nginx/sbin/nginx /usr/local/nginx/sbin/nginx.old</span><br><span class="line">mv：是否覆盖&quot;/usr/local/nginx/sbin/nginx.old&quot;？ y</span><br><span class="line">[root@localhost nginx-1.8.1]# cp objs/nginx /usr/local/nginx/sbin/</span><br><span class="line">[root@localhost nginx-1.8.1]# make upgrade</span><br><span class="line">/usr/local/nginx/sbin/nginx -t</span><br><span class="line">nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful</span><br><span class="line">kill -USR2 `cat /usr/local/nginx/logs/nginx.pid`</span><br><span class="line">sleep 1</span><br><span class="line">test -f /usr/local/nginx/logs/nginx.pid.oldbin</span><br><span class="line">kill -QUIT `cat /usr/local/nginx/logs/nginx.pid.oldbin`</span><br><span class="line">[root@localhost nginx-1.8.1]# /usr/local/nginx/sbin/nginx -V</span><br><span class="line">nginx version: nginx/1.8.1</span><br><span class="line">built by gcc 4.8.5 20150623 (Red Hat 4.8.5-4) (GCC) </span><br><span class="line">built with OpenSSL 1.0.1e-fips 11 Feb 2013</span><br><span class="line">TLS SNI support enabled</span><br><span class="line">configure arguments: --with-pcre=../pcre-8.38 --with-zlib=../zlib-1.2.8 --with-http_gzip_static_module --with-http_ssl_module --add-module=../nginx_tcp_proxy_module/ --add-module=../nginx_upstream_check_module/ --add-module=../nginx-module-vts/ --add-module=../nginx-upstream-jvm-route/</span><br></pre></td></tr></table></figure>
<p>配置nginx.conf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    upstream  tomcats_jvm_route &#123;</span><br><span class="line">        server   127.0.0.1:8081 srun_id=tomcat01; </span><br><span class="line">        server   127.0.0.1:8082 srun_id=tomcat02;</span><br><span class="line">        jvm_route $cookie_JSESSIONID|sessionid reverse;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        #....原有配置.....</span><br><span class="line">        location ~ .*\.(do|jsp|action)?$ &#123;</span><br><span class="line">            proxy_redirect          off;</span><br><span class="line">            proxy_set_header        Host            $host;</span><br><span class="line">            proxy_set_header        X-Real-IP       $remote_addr;</span><br><span class="line">            proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">            #proxy_pass http://tomcat;</span><br><span class="line">            proxy_pass http://tomcats_jvm_route;</span><br><span class="line">        &#125;</span><br><span class="line">        #....原有配置.....</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改tomcat的server.xml配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;Engine name=&quot;Catalina&quot; defaultHost=&quot;localhost&quot; jvmRoute=&quot;tomcat01&quot;&gt;</span><br><span class="line">&lt;Engine name=&quot;Catalina&quot; defaultHost=&quot;localhost&quot; jvmRoute=&quot;tomcat02&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>验证生效</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ps -ef |grep tomcat|grep -v grep|awk &#x27;&#123;print $2&#125;&#x27;</span><br><span class="line">19914</span><br><span class="line">20029</span><br><span class="line">[root@localhost ~]# ps -ef |grep tomcat|grep -v grep|awk &#x27;&#123;print $2&#125;&#x27;|xargs kill</span><br><span class="line">[root@localhost ~]# ps -ef |grep tomcat|grep -v grep|awk &#x27;&#123;print $2&#125;&#x27;</span><br><span class="line">[root@localhost ~]# cd tomcat-1/</span><br><span class="line">[root@localhost tomcat-1]# ./bin/startup.sh </span><br><span class="line">Using CATALINA_BASE:   /root/tomcat-1</span><br><span class="line">Using CATALINA_HOME:   /root/tomcat-1</span><br><span class="line">Using CATALINA_TMPDIR: /root/tomcat-1/temp</span><br><span class="line">Using JRE_HOME:        /usr/local/jdk1.7.0_60</span><br><span class="line">Using CLASSPATH:       /root/tomcat-1/bin/bootstrap.jar:/root/tomcat-1/bin/tomcat-juli.jar</span><br><span class="line">Tomcat started.</span><br><span class="line">[root@localhost tomcat-1]# cd ../tomcat-2</span><br><span class="line">-bash: cd: tomcat-2: 没有那个文件或目录</span><br><span class="line">[root@localhost tomcat-2]# ./bin/startup.sh </span><br><span class="line">Using CATALINA_BASE:   /root/tomcat-1</span><br><span class="line">Using CATALINA_HOME:   /root/tomcat-1</span><br><span class="line">Using CATALINA_TMPDIR: /root/tomcat-1/temp</span><br><span class="line">Using JRE_HOME:        /usr/local/jdk1.7.0_60</span><br><span class="line">Using CLASSPATH:       /root/tomcat-1/bin/bootstrap.jar:/root/tomcat-1/bin/tomcat-juli.jar</span><br><span class="line">Tomcat started.</span><br><span class="line">[root@localhost tomcat-2]# /usr/local/nginx/sbin/nginx -t;/usr/local/nginx/sbin/nginx -s reload;</span><br></pre></td></tr></table></figure>
<p><img src="/images/QQ20160318-0.png"><br><img src="/images/QQ20160318-1.png"><br><img src="/images/QQ20160318-2.png"></p>
<p>从上图的结果来看：</p>
<ul>
<li>1: sessionID的后面增加了第一个为客户端服务的最终tomcat实例标识。</li>
<li>2: 在不停的刷新页面的时候都是同一个tomcat实例返回的页面。从vts的监控图可以看出，请求都被导流到同一个tomcat实例上。</li>
<li>3: 在停止tomcat1后，再对浏览器进行刷新操作，发现请求被导到tomcat2上，但对应的sessionId也发生了变化，说明服务器端认定这是一个新的客户端进行的请求操作。验证了我之前所说，__这种方式不支持故障转移__。</li>
</ul>
<hr>
<p><em>观点仅代表自己，期待你的留言。</em></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Nginx/" rel="tag">Nginx</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-tomcat-redis-session" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/17/tomcat-redis-session/" class="article-date">
  	<time datetime="2016-03-17T03:32:15.000Z" itemprop="datePublished">2016-03-17</time>
</a>
      <div class="analysis-container">
	<i class="fa fa-line-chart"></i>
	已阅读<span id=“busuanzi_container_page_pv”><span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span></span> 次
</div>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/17/tomcat-redis-session/">Nginx+tomcat+redis集群之session共享</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
              
        <h2 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h2><p>CentOS7, Tomcat7(tomcat-1, tomcat-2), Nginx1.8.1, redis3.0.7</p>
<h2 id="安装redis与tomcat"><a href="#安装redis与tomcat" class="headerlink" title="安装redis与tomcat"></a>安装redis与tomcat</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# wget http://download.redis.io/releases/redis-3.0.7.tar.gz</span><br><span class="line">[root@localhost ~]# wget http://mirror.nus.edu.sg/apache/tomcat/tomcat-7/v7.0.68/bin/apache-tomcat-7.0.68.tar.gz</span><br><span class="line">[root@localhost ~]# tar -xvf redis-3.0.7.tar.gz; cd redis-3.0.7</span><br><span class="line">[root@localhost redis-3.0.7]# make &amp;&amp; make install</span><br><span class="line">[root@localhost redis-3.0.7]# redis-server &amp; //运行redis服务</span><br><span class="line">[root@localhost ~]# tar -xvf apache-tomcat-7.0.68.tar.gz</span><br><span class="line">[root@localhost ~]# mv apache-tomcat-7.0.68 tomcat-1; cp -r tomcat-1 tomcat-2</span><br></pre></td></tr></table></figure>
<p>在tomcat-1和tomcat-2的webapps/ROOT目录下新增一个名叫session.jsp的文件，内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page  %&gt;</span><br><span class="line">Tomcat1（tomcat-2中为Tomcat2） SessionId = &lt;%=session.getId() %&gt;</span><br></pre></td></tr></table></figure>
<h3 id="修改tomcat与nginx配置"><a href="#修改tomcat与nginx配置" class="headerlink" title="修改tomcat与nginx配置"></a>修改tomcat与nginx配置</h3><p>架设场景如下图：</p>
<p><img src="/images/nginx-tomcat-redis.png" alt="架设场景"></p>
<ul>
<li>修改tomcat端口(conf/server.xml) </li>
</ul>
<p>tomcat1：Server port=”8105”，Connector port=”8081”，ajp Connector port=”8109”</p>
<p>tomcat2：Server port=”8205”，Connector port=”8082”，ajp Connector port=”8209”</p>
<ul>
<li>修改nginx配置，以随机访问的方式将请求引入后端的tomcat集群中<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    upstream tomcat &#123;</span><br><span class="line">       server 127.0.0.1:8081;</span><br><span class="line">       server 127.0.0.1:8082;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line">        #charset koi8-r;</span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line">        location ~ .*\.(do|jsp|action)?$ &#123;</span><br><span class="line">            proxy_redirect          off;</span><br><span class="line">            proxy_set_header        Host            $host;</span><br><span class="line">            proxy_set_header        X-Real-IP       $remote_addr;</span><br><span class="line">            proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">            proxy_pass http://tomcat;</span><br><span class="line">        &#125;</span><br><span class="line">        #配置Nginx动静分离，定义的静态页面直接从Nginx发布目录读取。</span><br><span class="line">        location ~ .*\.(html|htm|gif|jpg|jpeg|bmp|png|ico|txt|js|css)$ &#123;</span><br><span class="line">            root /data/;</span><br><span class="line">            gzip_static on; #开启压缩静态资源</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        location / &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
然后访问<a target="_blank" rel="noopener" href="http://10.28.10.218/session.jsp">http://10.28.10.218/session.jsp</a>   可以看到服务器随机返回给我们两个tomcat的session页面。同时我们也可以看到SessionId在不停的变化。</li>
</ul>
<p><img src="/images/QQ20160316-1.png" alt="Tomcat1的session.jsp"></p>
<p><img src="/images/QQ20160316-0.png" alt="Tomcat2的session.jsp"></p>
<p>通过Nginx的监控页也可以看出请求被随机的转发到了tomcat中</p>
<p><img src="/images/QQ20160316-2.png" alt="Nginx的监控页"></p>
<h2 id="将tomcat的session都存储到redis中"><a href="#将tomcat的session都存储到redis中" class="headerlink" title="将tomcat的session都存储到redis中"></a>将tomcat的session都存储到redis中</h2><p>Tomcat存储到Redis库项目地址：<a target="_blank" rel="noopener" href="https://github.com/jcoleman/tomcat-redis-session-manager">https://github.com/jcoleman/tomcat-redis-session-manager</a><br>从gradle配置上看，此项目还有三个依赖库。通过gradle进行编译，最终会自动从网络下载commons-pool,commons-pool2,jedis库并编译生成tomcat-redis-session-manager。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">  compile group: &#x27;org.apache.tomcat&#x27;, name: &#x27;tomcat-catalina&#x27;, version: &#x27;7.0.27&#x27;</span><br><span class="line">  compile group: &#x27;redis.clients&#x27;, name: &#x27;jedis&#x27;, version: &#x27;2.5.2&#x27;</span><br><span class="line">  compile group: &#x27;org.apache.commons&#x27;, name: &#x27;commons-pool2&#x27;, version: &#x27;2.2&#x27;</span><br><span class="line">  //compile group: &#x27;commons-codec&#x27;, name: &#x27;commons-codec&#x27;, version: &#x27;1.9&#x27;</span><br><span class="line"></span><br><span class="line">  testCompile group: &#x27;junit&#x27;, name: &#x27;junit&#x27;, version: &#x27;4.+&#x27;</span><br><span class="line">  testCompile &#x27;org.hamcrest:hamcrest-core:1.3&#x27;</span><br><span class="line">  testCompile &#x27;org.hamcrest:hamcrest-library:1.3&#x27;</span><br><span class="line">  testCompile &#x27;org.mockito:mockito-all:1.9.5&#x27;</span><br><span class="line">  testCompile group: &#x27;org.apache.tomcat&#x27;, name: &#x27;tomcat-coyote&#x27;, version: &#x27;7.0.27&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>觉得麻烦的同学可以直接下载以下库，放入到tomcat/lib下：<br><a href="/libs/commons-pool-1.5.5.jar">commons-pool-1.5.5.jar</a><br><a href="/libs/commons-pool2-2.2.jar">commons-pool2-2.2.jar</a><br><a href="/libs/jedis-2.0.0.jar">jedis-2.0.0.jar</a><br><a href="/libs/tomcat-redis-session-manager-1.2-tomcat-7-1.2.jar">tomcat-redis-session-manager-1.2-tomcat-7-1.2.jar</a></p>
<p>按tomcat-redis-session-manager在github上地址里的说明修改两个tomcat的context.xml（tomcat/conf/context.xml）增加存储配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;Valve className=&quot;com.radiadesign.catalina.session.RedisSessionHandlerValve&quot; /&gt;</span><br><span class="line">&lt;Manager className=&quot;com.radiadesign.catalina.session.RedisSessionManager&quot;</span><br><span class="line">         host=&quot;localhost&quot; &lt;!-- optional: defaults to &quot;localhost&quot; --&gt;</span><br><span class="line">         port=&quot;6379&quot; &lt;!-- optional: defaults to &quot;6379&quot; --&gt;</span><br><span class="line">         database=&quot;0&quot; &lt;!-- optional: defaults to &quot;0&quot; --&gt;</span><br><span class="line">         maxInactiveInterval=&quot;60&quot; &lt;!-- optional: defaults to &quot;60&quot; (in seconds) --&gt;</span><br><span class="line">         sessionPersistPolicies=&quot;PERSIST_POLICY_1,PERSIST_POLICY_2,..&quot; &lt;!-- optional --&gt;</span><br><span class="line">         sentinelMaster=&quot;SentinelMasterName&quot; &lt;!-- optional --&gt;</span><br><span class="line">         sentinels=&quot;sentinel-host-1:port,sentinel-host-2:port,..&quot; /&gt;</span><br></pre></td></tr></table></figure>
<p>修改好配置后，启动tomcat-1和tomcat-2。再访问session.jsp时你会发现无论是从哪一个tomcat返回的页面同一个客户端的sessionID都是相同的，这就达到了session在集群tomcat下共享的目的。</p>
<p><img src="/images/QQ20160317-0.png"><img src="/images/QQ20160317-1.png"></p>
<p>通过redis-cli命令连接到redis服务器，可以看到对应sessionID的数据已存储到了redis中。</p>
<p><img src="/images/QQ20160317-2.png"></p>
<p><strong>提醒：session的超时时间由context.xml中的maxInactiveInterval配置，默认60秒</strong></p>
<hr>
<p><em>观点仅代表自己，期待你的留言。</em></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Nginx/" rel="tag">Nginx</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/" rel="tag">redis</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tomcat/" rel="tag">tomcat</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-nginx-upgrade" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/16/nginx-upgrade/" class="article-date">
  	<time datetime="2016-03-16T03:29:07.000Z" itemprop="datePublished">2016-03-16</time>
</a>
      <div class="analysis-container">
	<i class="fa fa-line-chart"></i>
	已阅读<span id=“busuanzi_container_page_pv”><span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span></span> 次
</div>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/16/nginx-upgrade/">Nginx不停止服务下升级与Nginx服务监控</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
              
        <h3 id="一、文章目的"><a href="#一、文章目的" class="headerlink" title="一、文章目的"></a>一、文章目的</h3><p>本文以添加新模块”ngx_http_stub_status_module”为例介绍Nginx如果在不停止服务的情况下进行升级。</p>
<h3 id="二、Nginx升级"><a href="#二、Nginx升级" class="headerlink" title="二、Nginx升级"></a>二、Nginx升级</h3><p>先查看一下目前现在模块：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost sbin]# ./nginx -V</span><br><span class="line">nginx version: nginx/1.8.1</span><br><span class="line">built by gcc 4.8.5 20150623 (Red Hat 4.8.5-4) (GCC) </span><br><span class="line">built with OpenSSL 1.0.1e-fips 11 Feb 2013</span><br><span class="line">TLS SNI support enabled</span><br><span class="line">configure arguments: --with-pcre=../pcre-8.38 --with-zlib=../zlib-1.2.8 --with-http_gzip_static_module --with-http_ssl_module --add-module=../nginx_tcp_proxy_module/ --add-module=../nginx_upstream_check_module/ --add-module=../nginx-module-vts/</span><br></pre></td></tr></table></figure>
<p>进入到nginx源码目录（或者直接从网络上下载。参见博文[ Nginx在CentOS7上源码编译安装 ]）,编译时增加所需添加的模块：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost nginx-1.8.1]# cd ~/nginx-1.8.1</span><br><span class="line">[root@localhost nginx-1.8.1]# ./configure --with-pcre=../pcre-8.38 --with-zlib=../zlib-1.2.8 --with-http_gzip_static_module --with-http_stub_status_module --with-http_ssl_module --add-module=../nginx_tcp_proxy_module/ \--add-module=../nginx_upstream_check_module/ \--add-module=../nginx-module-vts/</span><br><span class="line">[root@localhost nginx-1.8.1]# make</span><br></pre></td></tr></table></figure>
<p>将编译出的objs目录下及nginx运行文件直接copy到原nginx目录（注意备份）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost nginx-1.8.1]# mv /usr/local/nginx/sbin/nginx /usr/local/nginx/sbin/nginx.old</span><br><span class="line">[root@localhost nginx-1.8.1]# cp objs/nginx /usr/local/nginx/sbin/</span><br><span class="line">[root@localhost nginx-1.8.1]# make upgrade</span><br><span class="line">/usr/local/nginx/sbin/nginx -t</span><br><span class="line">nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful</span><br><span class="line">kill -USR2 `cat /usr/local/nginx/logs/nginx.pid`</span><br><span class="line">sleep 1</span><br><span class="line">test -f /usr/local/nginx/logs/nginx.pid.oldbin</span><br><span class="line">kill -QUIT `cat /usr/local/nginx/logs/nginx.pid.oldbin`</span><br><span class="line">[root@localhost sbin]# ./nginx -V</span><br><span class="line">nginx version: nginx/1.8.1</span><br><span class="line">built by gcc 4.8.5 20150623 (Red Hat 4.8.5-4) (GCC) </span><br><span class="line">built with OpenSSL 1.0.1e-fips 11 Feb 2013</span><br><span class="line">TLS SNI support enabled</span><br><span class="line">configure arguments: --with-pcre=../pcre-8.38 --with-zlib=../zlib-1.2.8 --with-http_gzip_static_module --with-http_stub_status_module --with-http_ssl_module --add-module=../nginx_tcp_proxy_module/ --add-module=../nginx_upstream_check_module/ --add-module=../nginx-module-vts/</span><br></pre></td></tr></table></figure>
<p>从以上的输出信息来看，nginx已经成功添加了http_stub_status_module模块。接下来，我们进行验证。</p>
<h3 id="验证ngx-http-stub-status-module模块是否生效"><a href="#验证ngx-http-stub-status-module模块是否生效" class="headerlink" title="验证ngx_http_stub_status_module模块是否生效"></a>验证ngx_http_stub_status_module模块是否生效</h3><p>在conf/nginx.conf的server节点下添加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /status &#123;</span><br><span class="line">    stub_status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重新load一下nginx配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost sbin]# ./nginx -t;./nginx -s reload</span><br><span class="line">nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful</span><br></pre></td></tr></table></figure>

<p>然后通过浏览器访问<a target="_blank" rel="noopener" href="http://10.28.10.218/status">http://10.28.10.218/status</a>  就可以看到nginx的运行状态已经通过界面的方式显示出来了。</p>
<p>由于http_stub_status_module模块监控的状态项非常有限，建议使用nginx-module-vts模块对nginx进行更全面的运行状态监控。<br><img src="/images/vts.png" alt="Nginx VTS"></p>
<p>nginx.conf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">	vhost_traffic_status_zone;</span><br><span class="line">	server &#123;</span><br><span class="line">		location /vts &#123;</span><br><span class="line">           vhost_traffic_status_display;</span><br><span class="line">           vhost_traffic_status_display_format html;</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="三、提高nginx监控页面的安全性"><a href="#三、提高nginx监控页面的安全性" class="headerlink" title="三、提高nginx监控页面的安全性"></a>三、提高nginx监控页面的安全性</h3><p>由于nginx的运行状态为非常重要的数据，所以只允许有特定权限的人员才能有权访问，所以我们可以通过http_auth_basic_module模块来进行身份的验证。更为关键的是http_auth_basic_module模块默认已安装。</p>
<p>通过“yum provides *bin/htpasswd”查看哪个库中有htpasswd命令，安装账户生成命令htpasswd，并添加一个用户admin</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost nginx-1.8.1]# yum provides \*bin/htpasswd</span><br><span class="line">已加载插件：fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.sina.cn</span><br><span class="line"> * epel: ftp.cuhk.edu.hk</span><br><span class="line"> * extras: mirrors.sina.cn</span><br><span class="line"> * updates: mirrors.sina.cn</span><br><span class="line">base/7/x86_64/filelists_db                                                                                                                                    | 6.2 MB  00:00:01     </span><br><span class="line">httpd-tools-2.4.6-40.el7.centos.x86_64 : Tools for use with the Apache HTTP Server</span><br><span class="line">源    ：base</span><br><span class="line">匹配来源：</span><br><span class="line">文件名    ：/usr/bin/htpasswd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost nginx-1.8.1]# yum install httpd-tools</span><br><span class="line">[root@localhost nginx-1.8.1]# whereis htpasswd //查看是否安装成功</span><br><span class="line">htpasswd: /usr/bin/htpasswd /usr/share/man/man1/htpasswd.1.gz</span><br><span class="line">[root@localhost nginx]# htpasswd -c ./nginx.auth admin //在nginx目录下会生成一个nginx.auth文件来存储账户信息,第二次添加用户就不需要加-c的参数了</span><br><span class="line">New password: </span><br><span class="line">Re-type new password: </span><br><span class="line">Adding password for user admin</span><br></pre></td></tr></table></figure>
<p>在conf/nginx.conf的location status节点内添加以下身份验证配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">	vhost_traffic_status_zone;</span><br><span class="line">	server &#123;</span><br><span class="line">		location /vts &#123;</span><br><span class="line">           auth_basic &quot;Restricted&quot;;</span><br><span class="line">           auth_basic_user_file ../nginx.auth;</span><br><span class="line">           vhost_traffic_status_display;</span><br><span class="line">           vhost_traffic_status_display_format html;</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重新热更新一下配置，再次通过浏览器访问时就会弹框提示你输入用户名和密码了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost sbin]# ./nginx -t;./nginx -s reload</span><br><span class="line">nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful</span><br></pre></td></tr></table></figure>
<p><img src="/images/nginx_auth.png" alt="Nginx Auth"></p>
<hr>
<p><em>观点仅代表自己，期待你的留言。</em></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Nginx/" rel="tag">Nginx</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-nginx-install" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/14/nginx-install/" class="article-date">
  	<time datetime="2016-03-14T03:32:15.000Z" itemprop="datePublished">2016-03-14</time>
</a>
      <div class="analysis-container">
	<i class="fa fa-line-chart"></i>
	已阅读<span id=“busuanzi_container_page_pv”><span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span></span> 次
</div>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/14/nginx-install/">Nginx在CentOS7上源码编译安装</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
              
        <h3 id="下载Nginx源码及依赖库"><a href="#下载Nginx源码及依赖库" class="headerlink" title="下载Nginx源码及依赖库"></a>下载Nginx源码及依赖库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# wget http://nginx.org/download/nginx-1.8.1.tar.gz</span><br><span class="line">[root@localhost ~]# yum install -y gcc gcc-c++</span><br><span class="line">[root@localhost ~]# wget http://jaist.dl.sourceforge.net/project/pcre/pcre/8.38/pcre-8.38.tar.gz</span><br><span class="line">[root@localhost ~]# wget http://zlib.net/zlib-1.2.8.tar.gz</span><br></pre></td></tr></table></figure>
<h3 id="下载Nginx模块"><a href="#下载Nginx模块" class="headerlink" title="下载Nginx模块"></a>下载Nginx模块</h3><p>Nginx官网所有模块列表  <a target="_blank" rel="noopener" href="http://nginx.org/en/docs/">http://nginx.org/en/docs/</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum -y install openssl openssl-devel</span><br><span class="line">[root@localhost ~]# git clone https://github.com/vozlt/nginx-module-vts.git </span><br><span class="line">[root@localhost ~]# git clone https://github.com/yaoweibin/nginx_tcp_proxy_module.git</span><br><span class="line">[root@localhost ~]# git clone https://github.com/yaoweibin/nginx_upstream_check_module.git</span><br></pre></td></tr></table></figure>
<h3 id="编译安装Nginx"><a href="#编译安装Nginx" class="headerlink" title="编译安装Nginx"></a>编译安装Nginx</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# tar xvf nginx-1.8.1.tar.gz</span><br><span class="line">[root@localhost ~]# tar xvf pcre-8.38.tar.gz</span><br><span class="line">[root@localhost ~]# tar xvf zlib-1.2.8.tar.gz</span><br><span class="line">[root@localhost ~]# cd nginx-1.8.1</span><br><span class="line">[root@localhost nginx-1.8.1]# patch -p1 &lt; ../nginx_tcp_proxy_module/tcp.patch</span><br><span class="line">[root@localhost nginx-1.8.1]# patch -p1 &lt; ../nginx_upstream_check_module/check_1.7.5+.patch //按nginx版本来执行不同的补丁文件</span><br><span class="line">[root@localhost nginx-1.8.1]# ./configure --with-pcre=../pcre-8.38 --with-zlib=../zlib-1.2.8 --with-http_gzip_static_module --with-http_ssl_module --add-module=../nginx_tcp_proxy_module/ \--add-module=../nginx_upstream_check_module/ \--add-module=../nginx-module-vts/</span><br><span class="line">[root@localhost nginx-1.8.1]# make </span><br><span class="line">[root@localhost nginx-1.8.1]# make install</span><br><span class="line">[root@localhost nginx-1.8.1]# /usr/local/nginx/sbin/nginx -V </span><br><span class="line">nginx version: nginx/1.8.1</span><br><span class="line">built by gcc 4.8.5 20150623 (Red Hat 4.8.5-4) (GCC) </span><br><span class="line">built with OpenSSL 1.0.1e-fips 11 Feb 2013</span><br><span class="line">TLS SNI support enabled</span><br><span class="line">configure arguments: --with-pcre=../pcre-8.38 --with-zlib=../zlib-1.2.8 --with-http_gzip_static_module --with-http_ssl_module --add-module=../nginx_tcp_proxy_module/ --add-module=../nginx_upstream_check_module/ --add-module=../nginx-module-vts/</span><br><span class="line">[root@localhost nginx-1.8.1]# /usr/local/nginx/sbin/nginx</span><br><span class="line">[root@localhost nginx-1.8.1]# systemctl stop firewalld.service //关闭防火墙，开放访问端口80</span><br></pre></td></tr></table></figure>
<p><img src="/images/nginx.png" alt="Nginx Welcome"></p>
<p>nginx安装目录默认为: /usr/local/nginx, 可通过在configure时增加–prefix=”path”来更改。</p>
<p>nginx启动时默认用户及用户组设置：</p>
<ul>
<li>通过在configure时增加–user=”user name”和–group=”group name”来更改。</li>
<li>在nginx.conf里增加user “user name” “group name”来更改。</li>
</ul>
<p><strong>注意: 在configure时如需添加多个第三方module时，从第二个–add-module开始，在之前需要加“\”</strong></p>
<hr>
<p><em>观点仅代表自己，期待你的留言。</em></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Nginx/" rel="tag">Nginx</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-e-bussiness-architecture" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/11/e-bussiness-architecture/" class="article-date">
  	<time datetime="2016-03-11T07:30:07.000Z" itemprop="datePublished">2016-03-11</time>
</a>
      <div class="analysis-container">
	<i class="fa fa-line-chart"></i>
	已阅读<span id=“busuanzi_container_page_pv”><span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span></span> 次
</div>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/11/e-bussiness-architecture/">关于电商系统业务模块猜想</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
              
        <h5 id="电商四大体系"><a href="#电商四大体系" class="headerlink" title="电商四大体系"></a>电商四大体系</h5><ul>
<li>企业信息化</li>
<li>电商网络体系</li>
<li>线上监控体系</li>
<li>数据分析体系</li>
</ul>
<p><img src="/images/%E5%9B%9B%E5%A4%A7%E4%BD%93%E7%B3%BB.png" alt="电商四大体系"></p>
<h5 id="电商业务模块"><a href="#电商业务模块" class="headerlink" title="电商业务模块"></a>电商业务模块</h5><p>经过与朋友们的讨论，笔者着手总结电商应包含的模块如下：</p>
<p><img src="/images/%E7%94%B5%E5%95%86%E4%B8%9A%E5%8A%A1%E6%A8%A1%E5%9D%97%E6%80%BB%E8%A7%88.png" alt="电商业务模块总览"></p>
<p>笔者认为电商门户建设应从企业信息化建设入手，逐步加入电商元素，最终形成企业电商。</p>
<hr>
<p><em>观点仅代表自己，期待你的留言。</em></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9E%B6%E6%9E%84/" rel="tag">架构</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%94%B5%E5%95%86/" rel="tag">电商</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-started" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/10/started/" class="article-date">
  	<time datetime="2016-03-10T08:46:19.000Z" itemprop="datePublished">2016-03-10</time>
</a>
      <div class="analysis-container">
	<i class="fa fa-line-chart"></i>
	已阅读<span id=“busuanzi_container_page_pv”><span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span></span> 次
</div>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/10/started/">博客站开写啦</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
              
        <p>经过两天的努力总算搭建一个属于自己的博客站，不得不感叹自己真的是太懒了，原本很早以前就想做的事情偏偏等到现在才来完成，懒！懒！懒！</p>
<p>为了让自己形成坚持记录的习惯，理清工作中千丝万缕的思路，让瞬间的“天马行空”留下痕迹。</p>
<p>我决定以后坚持写博客，并开通评论功能接收各位朋友的褒贬建议。</p>
<p>不积跬步，无以至千里；不积小流，无以成江海。坚持写作，观点仅代表自己，加油！！！</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%9A%8F%E7%AC%94/" rel="tag">随笔</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/9/">上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span>
    </nav>
  

</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2024 建均笔记
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">



<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>

<script src="/js/require-2.1.6,jquery-1.9.1.min.js"></script>


<script src="/js/main.js"></script>



<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'true', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>




<link href="//cdn.bootcss.com/highlight.js/8.0/styles/tomorrow-night-bright.min.css" rel="stylesheet">  
<script src="//cdn.bootcss.com/highlight.js/8.0/highlight.min.js"></script>  
<script> 
jQuery('td.code pre').each(function(i, block) {
  hljs.highlightBlock(block);
});
</script>


  </div>
</body>
</html>